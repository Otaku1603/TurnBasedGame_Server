worker_processes 1;

events {
    worker_connections 1024;
}

# 1. HTTP -> HTTPS 反向代理
http {
    include       mime.types;
    default_type  application/octet-stream;

    server {
        # 监听 443 SSL
        listen 443 ssl;
        server_name localhost;

        # 证书路径（对应 Docker 里的路径）
        ssl_certificate     /etc/nginx/cert/server.crt;
        ssl_certificate_key /etc/nginx/cert/server.key;

        # 代理到后端 Spring Boot
        location / {
            proxy_pass http://game-server:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}

# 2. TCP -> SSL TCP 反向代理 (Netty)
stream {
    server {
        # 对外监听 9999 (SSL 加密)
        listen 9999 ssl;

        # 证书配置
        ssl_certificate     /etc/nginx/cert/server.crt;
        ssl_certificate_key /etc/nginx/cert/server.key;

        # 握手超时设置
        ssl_handshake_timeout 10s;

        # 转发给后端的明文 TCP 端口
        # 注意：这里不能写 localhost，要写 docker-compose 里的服务名
        proxy_pass game-server:9999;
    }
}